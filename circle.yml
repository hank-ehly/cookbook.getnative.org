dependencies:
  override:
    - bundle install -j4 --path vendor/bundle
    - bundle exec berks vendor vendor/cookbooks

test:
  pre:
    - mkdir -p ${HOME}/.ssh/google-compute-engine
    - echo $CHEF_PRIVATE_KEY > ${HOME}/.ssh/google-compute-engine/chef
    - echo $GCLOUD_SERVICE_KEY | base64 --decode > ${HOME}/gcloud-service-key.json
    - echo $GITHUB_CREDENTIALS | base64 --decode > data_bags/github/credentials.json
    - echo $AUTHORIZED_KEYS | base64 --decode > data_bags/development-web/ssh.json
    - echo $HTPASSED | base64 --decode > data_bags/development-web/htpasswd.json
  override:
    - KITCHEN_YAML=".kitchen.gce.yml" bundle exec kitchen test web-ubuntu-1604
