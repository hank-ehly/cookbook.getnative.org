<VirtualHost *:80>
    ServerName <%= @params[:server_name] %>
    ServerAdmin <%= node[:apache][:contact] %>
    DocumentRoot <%= @params[:docroot] %>

    <% if @params[:server_aliases] -%>
    ServerAlias <%= @params[:server_aliases].join " " %>
    <% end -%>

    <Directory <%= @params[:docroot] %>>
        Options <%= [@params[:directory_options] || "FollowSymLinks"].flatten.join " " %>
        AllowOverride <%= [@params[:allow_override] || "None"].flatten.join " " %>
        Require all granted

        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>

    ErrorLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-error.log
    CustomLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-access.log combined

    <IfModule mod_deflate.c>
        SetOutputFilter DEFLATE
    </IfModule>
</VirtualHost>
